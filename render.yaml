version: 1
services:
  - type: web
    name: te-po-kitenga-backend
    env: docker
    plan: starter
    branch: main
    rootDir: te_po
    dockerfilePath: Dockerfile
    numInstances: 1
    healthCheckPath: /heartbeat
    autoDeploy: true
    buildFilter:
      paths:
        - te_po/**
    
    # Environment variables - required for te_po to function
    envVars:
      # OpenAI Configuration
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_BACKEND_MODEL
        value: gpt-4o-mini
      - key: OPENAI_TRANSLATION_MODEL
        value: gpt-4o-mini
      - key: OPENAI_VISION_MODEL
        value: gpt-4o-mini
      - key: OPENAI_UI_MODEL
        value: gpt-4o
      
      # Supabase Configuration
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      
      # Database Configuration
      - key: DATABASE_URL
        sync: false
      
      # Redis Configuration (optional but recommended for production)
      - key: REDIS_URL
        sync: false
      
      # Locale Configuration (critical for MƒÅori text support)
      - key: LANG
        value: mi_NZ.UTF-8
      - key: LC_ALL
        value: mi_NZ.UTF-8
      - key: PYTHONIOENCODING
        value: utf-8
      
      # Application Configuration
      - key: TE_PO_PORT
        value: "$PORT"
      - key: TE_PO_HOST
        value: "0.0.0.0"

# ===== OPTIONAL MULTI-SERVICE SETUP =====
# Uncomment below to deploy te_ao (frontend) alongside te_po
# Both services will be deployed on the same git push
#
# - type: web
#   name: te-ao-studio-frontend
#   env: docker
#   plan: starter
#   branch: main
#   rootDir: te_ao
#   dockerfilePath: Dockerfile
#   numInstances: 1
#   healthCheckPath: /
#   autoDeploy: true
#   envVars:
#     - key: VITE_API_URL
#       value: https://te-po-kitenga-backend.onrender.com
